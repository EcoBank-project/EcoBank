<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ecobank.app.alarm.mapper.AlarmMapper">
<insert id="insertAlarm">
	    <selectKey keyProperty="alarmNo" 
	    		   resultType="Integer"
	    		   order="BEFORE">
			SELECT NVL(MAX(alarm_no), 0) + 1
			FROM alarm
		</selectKey>
        INSERT INTO alarm (alarm_no, 
        				   alarm_content, 
        				   alarm_code, 
        				   alarm_ref_no, 
        				   user_no)
        VALUES (#{alarmNo}, 
        		#{alarmContent}, 
        		#{alarmCode}, 
        		#{alarmRefNo}, 
        		#{userNo})
    </insert>
    
    <select id="getUserIdFromConfirmNo" parameterType="Integer" resultType="String">
    	SELECT use_id
		FROM users
		WHERE user_no = (SELECT user_no
        		         FROM chall_confirm
                		 WHERE confirm_no=#{confirmNo})
    </select>
</mapper>