<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{adminCommon/layouts/default_layout}"
      layout:fragment="Content">
    
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js" crossorigin="anonymous"></script>
    
    <script th:inline="javascript">
        window.addEventListener('DOMContentLoaded', event => {
            const datatablesSimple = document.getElementById('adminUsers');
            if (datatablesSimple) {
                new simpleDatatables.DataTable(datatablesSimple);
            }
        });

        function showReport(feedNo) {
            console.log("feedNo:", feedNo);
            
            fetch(`/getSnsDeclareList/${feedNo}`)
                .then(response => response.json())
                .then(data => {
                    let modalBody = document.getElementById('reportModalBody');
                    modalBody.innerHTML = ''; // 기존 내용을 초기화합니다.

                    if (Array.isArray(data)) {
                        data.forEach(report => {
                            modalBody.innerHTML += `
                                <p>신고번호: ${report.declareNo}</p>
                                <p>신고 일자: ${report.declareat}</p>
                                <p>확인자 번호: ${report.confirmUserNo}</p>
                                <p>DECLARE_CODE: ${report.declareCode}</p>
                                <p>신고 코드: ${report.feedNo}</p>
                                <hr/>
                            `;
                        });
                    } else {
                        modalBody.innerHTML = '<p>데이터 형식이 잘못되었습니다.</p>';
                    }
                    
                    // 신고 모달을 표시합니다.
                    $('#reportModal').modal('show');
                })
                .catch(error => console.error('Error:', error));
        }
    </script>

    <body>
        <div class="card">
            <div class="card-header">
                <i class="fas fa-table me-1"></i>회원 관리
            </div>
            <div class="card-body">
                <table class="table table-dark table-striped" id="adminUsers">
                    <thead>
                        <tr>
                            <th class="text-center">피드번호</th>
                            <th class="text-center">피드 작성 일자</th>
                            <th class="text-center">피드 상태</th>
                            <th class="text-center">업데이트</th>
                            <th class="text-center">댓글 보기</th>
                            <th class="text-center">신고</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="adminSns : ${adminSns}">
                            <td class="text-center" th:text="${adminSns.feedNo}"></td>
                            <td class="text-center" th:text="${#dates.format(adminSns.feedCreateAt, 'yyyy/MM/dd')}"></td>
                            <td class="text-center">
                                <form th:action="@{/updatefeedState}" method="post">
                                    <input type="hidden" name="feedNo" th:value="${adminSns.feedNo}"/>
                                    <select name="feedState" class="form-select form-select-sm">
                                        <option th:value="${adminSns.feedState}" th:text="${adminSns.feedState}" selected></option>
                                        <option value="F1">F1 공개</option>
                                        <option value="F2">F2 비공개</option>
                                    </select>
                            </td>
                            <td class="text-center">
                                <button type="submit" class="btn btn-primary btn-sm">업데이트</button>
                                </form>
                            </td>
                            <td class="text-center">
                                <a th:href="@{/SnsReplyDeclareList(feed_no=${adminSns.feedNo})}">댓글 보기</a>
                            </td>
                            <td class="text-center">
                                <button class="btn btn-warning btn-sm" th:onclick="'showReport(' + ${adminSns.feedNo} + ')'">신고</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 신고 내역 모달 -->
        <div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="reportModalLabel">신고 내역</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="reportModalBody">
                        <!-- 신고 내역이 여기에 표시됩니다. -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
