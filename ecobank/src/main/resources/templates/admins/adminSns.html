<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{adminCommon/layouts/default_layout}"
      layout:fragment="Content">

<body>
    <div class="col-lg-8">    
        <div class="card">
            <div class="card-header">
                <i class="fas fa-table me-1"></i>회원 관리
            </div>
            <div class="card-body">
                <table class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th class="text-center">피드번호</th>
                            <th class="text-center">피드 작성 일자</th>
                            <th class="text-center">회원번호</th>
                            <th class="text-center">피드 상태</th>
                            <th class="text-center">업데이트</th>
                            <th class="text-center">댓글 보기</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="adminSns : ${adminSns}">
                            <td class="text-center" th:text="${adminSns.feedNo}"></td>
                            <td class="text-center" th:text="${#dates.format(adminSns.feedCreateAt, 'yyyy/MM/dd')}"></td>
                            <td class="text-center">
                                <a href="#" th:onclick="'declareonclick(' + ${adminSns.feedNo} + ')'" th:text="${adminSns.UserNo}"></a>												
                            </td>
                            <td class="text-center">
                                <form th:action="@{/updatefeedState}" method="post">
                                    <input type="hidden" name="feedNo" th:value="${adminSns.feedNo}"/>
                                    <select name="feedState" class="form-select form-select-sm">
                                        <option th:value="${adminSns.feedState}" th:text="${adminSns.feedState}" selected></option>
                                        <option value="F1">F1 공개</option>
                                        <option value="F2">F2 비공개</option>
                                    </select>
                            </td>
                            <td class="text-center">
                                <button type="submit" class="btn btn-primary btn-sm">업데이트</button>
                                </form>
                            </td>
                            <td class="text-center">
                                <a th:href="@{/adminSns/replies/{feedNo}(feedNo=${adminSns.feedNo})}" class="btn btn-info btn-sm">댓글 보기</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <table class="table table-dark table-striped">
            <tbody>
                <tr>
                    <td>sns신고번호</td>
                </tr>
                <tr>    
                    <td id="declareNo"></td>
                </tr>
                <tr>    
                    <td>sns신고일자</td>
                </tr>
                <tr>    
                    <td id="declareat"></td>
                </tr>
                <tr>
                    <td>신고한 회원번호</td>
                </tr>
                <tr>
                    <td id="confirmUserNo"></td>
                </tr>
                <tr>    
                    <td>sns 신고 이유</td>
                </tr>
                <tr>    
                    <td id="declareCode"></td>
                </tr>
                <tr>    
                    <td>피드번호</td>
                </tr>
                <tr>    
                    <td id="feedNo"></td>
                </tr>               
            </tbody>
        </table>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function declareonclick(feedNo) {
            $.ajax({
                url: '/adminSns/' + feedNo,
                method: 'GET',
                success: function(result) {
                    console.log(result); // 서버에서 반환된 전체 JSON 데이터 구조 확인
                    console.log("declareNo:", result.DECLARE_NO); // declareNo 확인

                    // 서버로부터 데이터를 받아와 각 필드에 반영
                    $('#declareNo').text(result.DECLARE_NO !== undefined ? result.DECLARE_NO : "N/A");
                    $('#declareat').text(result.DECLAREAT !== undefined ? result.DECLAREAT : "N/A");
                    $('#confirmUserNo').text(result.CONFIRM_USER_NO !== undefined ? result.CONFIRM_USER_NO : "N/A");
                    $('#declareCode').text(result.DECLARE_CODE !== undefined ? result.DECLARE_CODE : "N/A");
                    $('#feedNo').text(result.FEED_NO !== undefined ? result.FEED_NO : "N/A");
                },
                error: function(err) {
                    console.error('Error:', err);
                }
            });
        }
    </script>

</body>
</html>
